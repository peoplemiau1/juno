# Juno Project Cleanup - Summary

## Выполненные исправления

### 1. Структура проекта

**Было:**
- 50+ тестовых файлов в корне
- Временные файлы (out.asm, out.c, log.txt) повсюду
- Дубликаты документации (all_code.txt, combined_ruby.txt)
- Скомпилированные файлы в корне

**Стало:**
```
juno-lang/
├── src/              # Исходники компилятора
├── stdlib/           # Стандартная библиотека
├── tests/            # Все тесты (test_*.juno)
├── examples/         # Примеры программ
├── build/            # Артефакты сборки
├── docs/             # Документация
├── main_native.rb    # Компилятор Windows
├── main_linux.rb     # Компилятор Linux
├── demo_v1.juno      # Демо v1.0
├── demo_v1.1.juno    # Демо v1.1
└── hello.juno        # Hello World
```

### 2. Критический баг: вызовы функций

**Проблема:**
```juno
fn add(a, b) { return a + b }
fn main() {
    return add(100, 200)  // Возвращал 44 вместо 300
}
```

**Причина:**
- `eval_expression` использует стек (push/pop) для вычисления бинарных операций
- При вызове функции аргументы вычисляются через `eval_expression`
- Второй аргумент затирал регистр первого аргумента

**Решение:**
- Все аргументы теперь вычисляются и сохраняются на стек ПЕРЕД загрузкой в регистры
- Изменены функции: `gen_user_fn_call` и `gen_method_call` в `src/codegen/parts/calls.rb`

### 3. .gitignore обновлен

Добавлены правила для:
- Артефакты сборки (*.exe, *.obj, *.o)
- Директория build/
- Логи (*.log, log.txt)
- Временные файлы
- IDE файлы (.vscode/, .idea/)
- Дампы кода (all_code.txt, etc.)

### 4. Документация

Создано:
- `STRUCTURE.md` - описание структуры проекта
- `CLEANUP_SUMMARY.md` - этот файл

Обновлено:
- `TODO.md` - отмечены исправленные баги
- Версия изменена на v1.3

## Тестирование

Рекомендуется протестировать:

```bash
# Тест вызовов с 2+ аргументами
ruby main_native.rb tests/test_call_order.juno
./build/output.exe

# Тест всех функций
ruby main_native.rb demo_v1.juno
./build/output.exe
```

## Следующие шаги

1. **Register allocation** - оптимизация использования регистров
2. **Полная поддержка указателей** - передача 2+ указателей, арифметика
3. **Типизация** - `let x: int = 5`
4. **Больше тестов** - автоматическое тестирование всех фич

---

Проект теперь в порядке.
